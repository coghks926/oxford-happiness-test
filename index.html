<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¥ìŠ¤í¼ë“œ í–‰ë³µ ì²™ë„ (OHQ)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            min-height: 100vh; color: #1f2937; line-height: 1.6;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 2rem 1.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
        .card {
            background: rgba(255,255,255,0.98);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 1.5rem; padding: clamp(1rem, 2.5vw, 2rem); box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: min(900px, 100%);
            word-break: keep-all;
        }
        .title { font-size: clamp(24px, 5vw, 34px); font-weight: 800; color: #0f172a; text-align: center; word-break: keep-all; }
        .subtitle { text-align: center; color: #475569; margin-top: .5rem; font-size: clamp(14px, 2.5vw, 18px); line-height: 1.6; word-break: keep-all; }
        .intro-desc {
            text-align: center;
            color: #64748b;
            margin-top: .5rem;
            font-size: clamp(11px, 2vw, 14px);
            white-space: nowrap;
        }
        .mobile-break { display: inline; }
        input, select, textarea {
            font-size: clamp(14px, 1.8vw, 16px);
        }
        .user-form-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            align-items: center;
        }
        .user-field {
            width: min(100%, 820px);
            margin: 0 auto;
        }
        .user-field + .user-field { margin-top: 0; }
        .consent input[type="checkbox"]{ position: relative; top: 2px; }
        .controls { display: flex; gap: .75rem; margin-top: 1rem; justify-content: center; flex-wrap: wrap; }
        .btn {
            background: linear-gradient(135deg, #6366f1, #22d3ee);
            color: #fff; border: 0; border-radius: .75rem; padding: clamp(.7rem, 2vw, 1rem) clamp(1rem, 2.5vw, 1.4rem);
            font-weight: 700; cursor: pointer; box-shadow: 0 6px 14px rgba(99,102,241,.35); font-size: clamp(14px, 2.2vw, 18px);
        }
        .btn.secondary { background: #e5e7eb; color: #374151; box-shadow: none; }
        .btn:disabled { background: #cbd5e1; color: #e2e8f0; cursor: not-allowed; box-shadow: none; }
        .q-header { display: flex; align-items: center; justify-content: space-between; margin: 1rem 0; }
        .q-number { font-weight: 800; color: #2563eb; }
        .q-text { font-size: clamp(18px, 3vw, 22px); color: #0f172a; margin-top: .5rem; text-align: center; line-height: 1.7; word-break: keep-all; }
        .scale { display: grid; grid-template-columns: repeat(6, 1fr); gap: clamp(.3rem, 1vw, .5rem); margin-top: 1rem; width: 100%; }
        .option { display: flex; flex-direction: column; gap: .3rem; align-items: center; justify-content: center; padding: clamp(.5rem, 1.5vw, .9rem); border: 2px solid #e5e7eb; border-radius: .75rem; background: #ffffff; cursor: pointer; position: relative; min-height: fit-content; }
        .option > div:first-child { font-weight: 800; white-space: nowrap; font-size: clamp(14px, 2.2vw, 18px); }
        .option > div:last-child { width: 100%; text-align: center; line-height: 1.3; font-size: clamp(11px, 1.8vw, 13px); color: #64748b; word-break: keep-all; max-height: 2.6em; overflow: hidden; }
        .option.selected { border-color: #22c55e; background: #ecfeff; }
        .legend { display: none; }
        .nav { display: flex; justify-content: space-between; gap: .75rem; margin-top: 1rem; }
        .nav.nav-question {
            align-items: center;
            width: 100%;
        }
        .nav.nav-question .center {
            flex: 1;
            display: flex;
            justify-content: center;
            gap: .75rem;
        }
        .progress { text-align: center; font-weight: 700; color: #334155; margin-top: .5rem; }
        .hidden { display: none; }
        .result-box { display: grid; gap: .75rem; margin-top: 1rem; }
        .band { padding: .75rem; border-radius: .5rem; }
        .b1 { background: #fee2e2; }
        .b2 { background: #fef3c7; }
        .b3 { background: #e0e7ff; }
        .b4 { background: #dcfce7; }
        .b5 { background: #bbf7d0; }
        .footer-note { margin-top: 1rem; text-align: center; color: #64748b; font-size: 12px; }
        .question-grid { display: grid; grid-template-columns: repeat(5, minmax(0, 1fr)); gap: .75rem; justify-items: stretch; align-items: stretch; }
        .question-grid .answered-badge,
        .question-grid .unanswered-badge {
            border-radius: 1rem;
            padding: .65rem 0;
            font-weight: 600;
            color: #475569;
            border: none;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 48px;
        }
        .question-grid .answered-badge { background: #dbeafe; color: #1d4ed8; }

        @media (max-width: 768px) {
            .container { padding: 1.5rem 1.25rem; }
            .card { padding: clamp(1.75rem, 6vw, 3rem); width: 100%; border-radius: 1.4rem; }
            .user-form-grid { gap: .9rem; }
            .user-field { width: 100%; margin: 0; }
            .intro-desc { white-space: normal; line-height: 1.6; }
            .mobile-break { display: block; }
            .q-header { flex-direction: column; gap: .35rem; align-items: center; }
            .q-number, .progress { font-size: clamp(14px, 3.5vw, 16px); }
            .scale { grid-template-columns: repeat(2, minmax(0, 1fr)); gap: .6rem; }
            .option { padding: .7rem; }
            .option > div:first-child { font-size: clamp(13px, 4vw, 16px); }
            .option > div:last-child { font-size: clamp(12px, 3.5vw, 14px); }
            .result-box { gap: .5rem; }
            .question-grid { grid-template-columns: repeat(5, minmax(0, 1fr)); gap: .55rem; }
        }

        @media (max-width: 480px) {
            .container { padding: 1.25rem 1rem; }
            .card { padding: 1.75rem; border-radius: 1.25rem; }
            .title { font-size: clamp(22px, 7vw, 28px); }
            .subtitle { font-size: clamp(13px, 4.5vw, 16px); }
            .scale { grid-template-columns: repeat(2, minmax(0, 1fr)); gap: .5rem; }
            .option { padding: .6rem; gap: .25rem; border-radius: 1rem; }
            .option > div:first-child { font-size: clamp(12px, 4.5vw, 15px); }
            .option > div:last-child { font-size: clamp(11px, 4vw, 13px); }
            .answer-container { gap: .75rem; }
            .review-container { gap: .75rem; }
            .question-grid { grid-template-columns: repeat(5, minmax(0, 1fr)); gap: .5rem; }
            .btn { padding: .85rem 1.1rem; }
            .user-form-grid { gap: 1rem; }
            input, select, textarea { font-size: 16px; }
        }
    </style>
    <script>
        // 29ê°œ ë¬¸í•­ (OHQ) - í•œêµ­ì–´ ìš”ì•½ ë¬¸êµ¬
        // ì‹¤ì œ ë¬¸í•­ ë¬¸êµ¬ëŠ” ì‚¬ìš©ì ì œê³µ ì´ë¯¸ì§€ì™€ ë™ì¼í•´ì•¼ í•˜ë¯€ë¡œ í•„ìš” ì‹œ ìˆ˜ì • ê°€ëŠ¥
        const items = [
            "ë‚˜ëŠ” ë‚˜ ìì‹ ì— ëŒ€í•´ íŠ¹ë³„íˆ ë§Œì¡±ìŠ¤ëŸ½ë‹¤ê³  ëŠë¼ì§€ ì•ŠëŠ”ë‹¤.",
            "ë‚˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ì—ê²Œ ê¹Šì€ ê´€ì‹¬ì„ ê°–ê³  ìˆë‹¤.",
            "ë‚˜ëŠ” ì‚¶ì´ ë§¤ìš° ë³´ëŒì°¨ë‹¤ê³  ëŠë‚€ë‹¤.",
            "ë‚˜ëŠ” ê±°ì˜ ëª¨ë“  ì‚¬ëŒë“¤ì—ê²Œ ë”°ëœ»í•œ ê°ì •ì„ ê°€ì§€ê³  ìˆë‹¤.",
            "ë‚˜ëŠ” ì•„ì¹¨ì— ìƒì¾Œí•˜ê²Œ ì¼ì–´ë‚˜ëŠ” ì¼ì´ ë“œë¬¼ë‹¤.",
            "ë‚˜ëŠ” ë¯¸ë˜ì— ëŒ€í•´ íŠ¹ë³„íˆ ë‚™ê´€ì ì´ì§€ ì•Šë‹¤.",
            "ë‚˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ê²ƒì„ ì¬ë¯¸ìˆê²Œ ëŠë‚€ë‹¤.",
            "ë‚˜ëŠ” ì–¸ì œë‚˜ ì–´ë–¤ ì¼ì— ëª°ì…í•˜ê³  í—Œì‹ í•˜ëŠ” í¸ì´ë‹¤.",
            "ë‚´ ì‚¶ì€ ê´œì°®ê³  ë§Œì¡±ìŠ¤ëŸ½ë‹¤ê³  ëŠë‚€ë‹¤.",
            "ë‚˜ëŠ” ì„¸ìƒì´ ì¢‹ì€ ê³³ì´ë¼ê³  ìƒê°í•˜ì§€ ì•ŠëŠ”ë‹¤.",
            "ë‚˜ëŠ” ìì£¼ ì›ƒëŠ”ë‹¤.",
            "ë‚˜ëŠ” ë‚´ ì‚¶ì— ëŒ€í•´ ì „ë°˜ì ìœ¼ë¡œ ë§Œì¡±í•œë‹¤.",
            "ë‚˜ëŠ” ë‚´ ì™¸ëª¨ê°€ ë§¤ë ¥ì ì´ë¼ê³  ìƒê°í•˜ì§€ ì•ŠëŠ”ë‹¤.",
            "í•˜ê³  ì‹¶ì€ ì¼ì´ ì‹¤ì œë¡œ í•œ ì¼ ì‚¬ì´ì—ëŠ” ê°„ê·¹ì´ ìˆë‹¤.",
            "ë‚˜ëŠ” ë§¤ìš° í–‰ë³µí•œ ì‚¬ëŒì´ë¼ê³  ìƒê°í•œë‹¤.",
            "ë‚˜ëŠ” ì‚¬ëŒì—ì„œ ì•„ë¦„ë‹¤ì›€ì„ ìì£¼ ë°œê²¬í•œë‹¤.",
            "ë‚˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ë°ê³  ê¸ì •ì ì¸ ì˜í–¥ì„ ì£¼ëŠ” í¸ì´ë‹¤.",
            "ë‚˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ì˜ ì–´ìš¸ë¦°ë‹¤.",
            "ë‚˜ëŠ” ë‚´ ì‚¶ì„ ë‚´ê°€ ì¡°ì ˆí•˜ê³  ìˆë‹¤ëŠ” ëŠë‚Œì´ ë³„ë¡œ ì—†ë‹¤.",
            "ì–´ë–¤ ì¼ë“¤ì´ í–‰ë³µí•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì€ ìì‹ ê°ì´ ìˆë‹¤.",
            "ë‚˜ëŠ” ì •ì‹ ì ìœ¼ë¡œ ë§¤ìš° ë§‘ê³  ë˜ë ·í•˜ë‹¤ê³  ëŠë‚€ë‹¤.",
            "ë‚˜ëŠ” ìì£¼ ê¸°ì¨ê³¼ í™˜í¬ë¥¼ ê²½í—˜í•œë‹¤.",
            "ë‚˜ëŠ” ê²°ì •ì„ ì‰½ê²Œ ë‚´ë¦¬ëŠ” í¸ì´ ì•„ë‹ˆë‹¤.",
            "ë‚´ ì‚¶ì—ëŠ” íŠ¹ë³„í•œ ì˜ë¯¸ë‚˜ ëª©ì ì´ ì—†ë‹¤ê³  ëŠë‚€ë‹¤.",
            "ë‚˜ëŠ” ì—ë„ˆì§€ê°€ ë„˜ì¹˜ëŠ” í¸ì´ë‹¤.",
            "ë‚˜ëŠ” ëŒ€ì²´ë¡œ ìƒí™©ì— ê¸ì •ì ì¸ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì‚¬ëŒì´ë‹¤.",
            "ë‚˜ëŠ” ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ìˆì„ ë•Œ ë³„ë¡œ ì¦ê²ì§€ ì•Šë‹¤.",
            "ë‚˜ëŠ” ê±´ê°•í•˜ë‹¤ê³  ëŠë¼ì§€ ì•ŠëŠ”ë‹¤.",
            "ë‚˜ëŠ” ê³¼ê±°ì— í–‰ë³µí•œ ê¸°ì–µì´ ë³„ë¡œ ì—†ë‹¤."
        ];

        // ì—­ì±„ì  ë¬¸í•­ ë²ˆí˜¸(1-based). ì´ë¯¸ì§€ì—ì„œ ì£¼í™©ìƒ‰(ë¶€ì • ë¬¸í•­) ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì • ê°€ëŠ¥
        // í˜„ì¬ ê¸°ë³¸ê°’ì€ ì¼ë°˜ì ìœ¼ë¡œ ì•Œë ¤ì§„ ë¶€ì •ë¬¸ ìœ„ì£¼ë¡œ ì„¤ì •
        const reverseItems = new Set([1,5,6,10,13,14,19,23,24,27,28,29]);

        const labels = ["ë§¤ìš° ê·¸ë ‡ì§€ ì•Šë‹¤", "ëŒ€ì²´ë¡œ ê·¸ë ‡ì§€ ì•Šë‹¤", "ë‹¤ì†Œ ê·¸ë ‡ì§€ ì•Šë‹¤", "ë‹¤ì†Œ ê·¸ë ‡ë‹¤", "ëŒ€ì²´ë¡œ ê·¸ë ‡ë‹¤", "ë§¤ìš° ê·¸ë ‡ë‹¤"];

        let state = { screen: 'intro', index: 0, answers: {}, userName: '', userGender: '', userAge: '', consent: false };

        function scoreOf(itemIndex, choice1to6) {
            if (choice1to6 == null) return 0;
            const qNum = itemIndex + 1;
            const raw = Number(choice1to6);
            // ì—­ì±„ì : 1<->6, 2<->5, 3<->4
            return reverseItems.has(qNum) ? (7 - raw) : raw;
        }

        function totalScore() {
            let sum = 0;
            for (let i = 0; i < items.length; i++) {
                const v = state.answers[i];
                sum += scoreOf(i, v);
            }
            return sum;
        }

        function getBand(total) {
            // ë²”ìœ„ í…ìŠ¤íŠ¸ë¥¼ í•´ì„ ë’¤ì— (N~Mì )ë¡œ ëª…ì‹œ
            if (total <= 87) return { cls: 'b1', text: 'ë§¤ìš° ë‚®ì€ í–‰ë³µ ìˆ˜ì¤€ - ìš°ìš¸ê°ì„ ëŠë¼ê±°ë‚˜ ì‚¶ì˜ ë§Œì¡±ë„ê°€ ë‚®ì„ ìˆ˜ ìˆìŒ (29~87ì )' };
            if (total <= 116) return { cls: 'b2', text: 'í‰ê·  ì´í•˜ì˜ í–‰ë³µ - ì¼ìƒì—ì„œ ìŠ¤íŠ¸ë ˆìŠ¤ë‚˜ ë¶ˆë§Œì´ ìˆì„ ìˆ˜ ìˆìŒ (88~116ì )' };
            if (total <= 145) return { cls: 'b3', text: 'í‰ê· ì ì¸ í–‰ë³µ - ì¼ë°˜ì ì¸ ì‚¬ëŒë“¤ê³¼ ë¹„ìŠ·í•œ ìˆ˜ì¤€ì˜ ì‚¶ì˜ ë§Œì¡±ë„ (117~145ì )' };
            if (total <= 174) return { cls: 'b4', text: 'ë†’ì€ í–‰ë³µ - ê¸ì •ì ì¸ ê°ì •ì´ ìì£¼ ëŠê»´ì§€ê³  ì‚¶ì— ëŒ€í•œ ë§Œì¡±ê°ì´ ë†’ìŒ (146~174ì )' };
            return { cls: 'b5', text: 'ë§¤ìš° ë†’ì€ í–‰ë³µ - ê·¹ë„ì˜ ê¸ì • ì •ì„œ ë° ë§Œì¡±ê°ì„ ê²½í—˜í•˜ëŠ” ìƒíƒœ (175ì  ì´ìƒ)' };
        }

        function render() {
            const app = document.getElementById('app');
            if (state.screen === 'intro') {
                app.innerHTML = `
                    <div class="container">
                        <div class="card">
                            <div style="text-align: center;">
                                <div class="title" style="font-size: clamp(28px, 6vw, 42px); font-weight: 900; color: #1e40af; margin-bottom: 0.5rem; line-height: 1.2;">ì˜¥ìŠ¤í¼ë“œ í–‰ë³µ ì²™ë„</div>
                                <div style="font-size: clamp(18px, 4vw, 26px); font-weight: 600; color: #64748b; white-space: nowrap;">(Oxford Happiness Questionnaire)</div>
                            </div>
                            <div class="intro-desc">
                                Michael Argyleê³¼ Peter Hillsê°€ ê°œë°œí•œ <span class="mobile-break">ì£¼ê´€ì  ì›°ë¹™(SWB, Subjective Well-Being) ì¸¡ì • ë„êµ¬</span>
                            </div>
                            <div class="subtitle">29ë¬¸í•­, 1~6ì . ìµœê·¼ì˜ ë³¸ì¸ ìƒíƒœë¥¼ ê°€ì¥ ì˜ ë‚˜íƒ€ë‚´ëŠ” ì‘ë‹µì„ ì„ íƒí•˜ì„¸ìš”.</div>
                            <div class="controls">
                                <button class="btn" onclick="state.screen='userinfo'; render()">ì‹œì‘í•˜ê¸°</button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            if (state.screen === 'userinfo') {
                app.innerHTML = `
                    <div class="container">
                        <div class="card" style="padding: clamp(2.3rem, 5.5vw, 3.5rem); border-radius: 1.5rem; max-width: 820px; width: min(100%, 92vw); margin: 0 auto;">
                            <div class="title" style="font-size: clamp(24px, 5vw, 34px); font-weight: 900; color: #1e40af; margin-bottom: 0.75rem; line-height: 1.2;">ì‚¬ìš©ì ì •ë³´ ì…ë ¥</div>
                            <div class="subtitle" style="margin-bottom: 2rem;">ê²€ì‚¬ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ì´ë¦„, ì„±ë³„, ë‚˜ì´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                            <div class="user-form-grid">
                                <div class="user-field">
                                    <label style="font-weight:700; color:#334155; font-size: clamp(14px,2vw,16px); margin-bottom: 0.5rem; display: block;">ì´ë¦„</label>
                                    <input id="u-name" type="text" value="${state.userName}" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%; height:48px; border:2px solid #e5e7eb; border-radius:.75rem; padding:0 1rem; font-size:16px; background:#fff; transition: all 0.3s ease;" onfocus="this.style.borderColor='#6366f1'; this.style.boxShadow='0 0 0 3px rgba(99,102,241,0.1)';" onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';" />
                                </div>
                                <div class="user-field">
                                    <label style="font-weight:700; color:#334155; font-size: clamp(14px,2vw,16px); margin-bottom: 0.5rem; display: block;">ì„±ë³„</label>
                                    <div style="width:100%; height:48px; border:2px solid #e5e7eb; border-radius:.75rem; padding:0 1rem; display:flex; align-items:center; justify-content:flex-start; gap:1.5rem; background:#fff; transition: all 0.3s ease;" onfocus="this.style.borderColor='#6366f1'; this.style.boxShadow='0 0 0 3px rgba(99,102,241,0.1)';" onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';">
                                        ${['ë‚¨ì„±','ì—¬ì„±'].map(g=>`
                                            <label style=\"display:flex; align-items:center; gap:.5rem; cursor:pointer;\">
                                                <input type=\"radio\" name=\"u-gender\" value=\"${g}\" ${state.userGender===g?'checked':''} style=\"width:18px; height:18px; accent-color:#6366f1; cursor:pointer;\" />
                                                <span style=\"font-size:clamp(14px,2.2vw,16px); color:#334155;\">${g}</span>
                                            </label>
                                        `).join('')}
                                    </div>
                                </div>
                                <div class="user-field">
                                    <label style="font-weight:700; color:#334155; font-size: clamp(14px,2vw,16px); margin-bottom: 0.5rem; display: block;">ë‚˜ì´</label>
                                    <select id="u-age" style="width:100%; height:48px; border:2px solid #e5e7eb; border-radius:.75rem; padding:0 1rem; font-size:16px; background:#fff; cursor:pointer; transition: all 0.3s ease; appearance: none; background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 fill=%22none%22 viewBox=%220 0 20 20%22%3E%3Cpath stroke=%22%236b7280%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22 stroke-width=%221.5%22 d=%22M6 8l4 4 4-4%22/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.25em;" onfocus="this.style.borderColor='#6366f1'; this.style.boxShadow='0 0 0 3px rgba(99,102,241,0.1)';" onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';">
                                        <option value="">ë‚˜ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                        ${['10ëŒ€','20ëŒ€','30ëŒ€','40ëŒ€','50ëŒ€','60ëŒ€','70ëŒ€ ì´ìƒ'].map(a=>`<option ${state.userAge===a?'selected':''}>${a}</option>`).join('')}
                                    </select>
                                </div>
                                <div class="user-field">
                                    <label style="display:flex; gap:.6rem; align-items:center; cursor:pointer; font-size:clamp(13px,2.1vw,15px); color:#475569; border:2px solid #e5e7eb; border-radius:.75rem; padding: 1rem; background:#fff;">
                                        <input id="u-consent" type="checkbox" ${state.consent?'checked':''} style="width:18px; height:18px; accent-color:#6366f1; cursor:pointer; position: relative; top: 2px;" />
                                        ì—°êµ¬Â·í†µê³„ ë° ì„œë¹„ìŠ¤ ê°œì„  ëª©ì ì˜ ìµëª… ì²˜ë¦¬ëœ ë°ì´í„° í™œìš©ì— ë™ì˜í•©ë‹ˆë‹¤.
                                    </label>
                                </div>
                            </div>
                            <div class="nav" style="margin-top: 2.5rem;">
                                <button class="btn secondary" onclick="state.screen='intro'; render()">â† ì´ì „</button>
                                <div style="flex:1"></div>
                                <button class="btn" onclick="startTestFromInfo()">ê²€ì‚¬ ì‹œì‘</button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            if (state.screen === 'test') {
                const i = state.index;
                const qNum = i + 1;
                const selected = state.answers[i] ?? null;
                const leftDisabled = i === 0;
                const rightDisabled = i === items.length - 1;
                const answeredCount = Object.keys(state.answers).length;
                const isReverse = reverseItems.has(qNum);
                app.innerHTML = `
                    <div class="container">
                        <div class="card">
                            <div class="q-header">
                                <div class="q-number">ì§ˆë¬¸ ${qNum}ë²ˆ</div>
                                <div class="progress">ì§„í–‰ë„ ${answeredCount}/${items.length}</div>
                            </div>
                            <div class="q-text" style="color:${isReverse ? '#92400e' : '#0f172a'};">${items[i]}</div>
                            <div class="scale">
                                ${labels.map((label, idx) => {
                                    const val = idx + 1;
                                    const isSel = Number(selected) === val;
                                    // ì—­ì±„ì ì´ë©´ ë‹µë³€ í…ìŠ¤íŠ¸ë¥¼ ì—­ìˆœìœ¼ë¡œ í‘œì‹œ (1ì â†’ë§¤ìš° ê·¸ë ‡ë‹¤, 6ì â†’ë§¤ìš° ê·¸ë ‡ì§€ ì•Šë‹¤)
                                    let displayLabel = isReverse ? labels[6 - val] : label;
                                    // ëª¨ë“  ë‹µë³€ì„ ë‘ ì¤„ë¡œ í†µì¼: ì²« ë‹¨ì–´ ë’¤ì—ì„œ ì¤„ë°”ê¿ˆ
                                    const parts = displayLabel.split(' ');
                                    if (parts.length > 1) {
                                        displayLabel = parts[0] + '<br>' + parts.slice(1).join(' ');
                                    }
                                    return `
                                        <button class=\"option ${isSel ? 'selected' : ''}\" onclick=\"selectChoice(${i}, ${val})\" style=\"min-width: 0; flex: 1;\">\n                                            <div>${val}ì </div>\n                                            <div>${displayLabel}</div>\n                                        </button>
                                    `;
                                }).join('')}
                            </div>
                        <div class="nav nav-question">
                            <button class="btn secondary" ${leftDisabled ? 'disabled' : ''} onclick="prevQ()">â† ì´ì „</button>
                            <div class="center">
                                <button class="btn secondary" onclick="openList()">ëª©ë¡</button>
                            </div>
                            <button class="btn" onclick="nextQ()">ë‹¤ìŒ â†’</button>
                        </div>
                        </div>
                    </div>
                `;
                return;
            }

            if (state.screen === 'list') {
                app.innerHTML = `
                    <div class="container">
                        <div class="card">
                            <div class="title" style="font-size:22px">ë¬¸í•­ ëª©ë¡</div>
                            <div class="controls" style="justify-content:flex-start">
                                ${items.map((_,i)=>{
                                    const done = state.answers[i]!=null;
                                    return `<button class="btn ${done?'' : 'secondary'}" onclick="gotoQ(${i})">${i+1}</button>`;
                                }).join('')}
                            </div>
                            <div class="nav" style="margin-top:1.25rem">
                                <button class="btn secondary" onclick="state.screen='test'; render()">ì´ì–´í•˜ê¸°</button>
                                <div style="flex:1"></div>
                                <button class="btn" onclick="finish()">ê²°ê³¼ ë³´ê¸°</button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            if (state.screen === 'result') {
                const total = totalScore();
                const band = getBand(total);
                app.innerHTML = `
                    <div class="container">
                        <div class="card">
                            <div class="title">ê²°ê³¼</div>
                            <div class="result-box">
                                <div style="font-size: clamp(16px,2.6vw,20px);"><strong>(ì´ ì ìˆ˜ í•©ê³„:)</strong> <span style="font-weight:800;color:#0ea5e9">${total}</span> / 174</div>
                                <div class="band ${band.cls}">${band.text}</div>
                            </div>
                            <div style="margin-top:1rem">
                                <details style="margin-bottom:.5rem;">
                                    <summary style="cursor:pointer;font-weight:700;color:#334155">ì ìˆ˜ ë²”ìœ„ ë³´ê¸°</summary>
                                    <div style="margin-top:.5rem;">
                                        <table style="width:100%; border-collapse:collapse; font-size:clamp(14px,2.2vw,16px);">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:left; padding:.5rem; border-bottom:2px solid #e5e7eb;">ì ìˆ˜ ë²”ìœ„</th>
                                                    <th style="text-align:left; padding:.5rem; border-bottom:2px solid #e5e7eb;">í•´ì„</th>
                                                </tr>
                                            </thead>
        							<tbody>
                                                <tr><td style="padding:.5rem; border-bottom:1px solid #e5e7eb;">29 ~ 87ì </td><td style="padding:.5rem; border-bottom:1px solid #e5e7eb;">ë§¤ìš° ë‚®ì€ í–‰ë³µ ìˆ˜ì¤€ - ìš°ìš¸ê°ì„ ëŠë¼ê±°ë‚˜ ì‚¶ì˜ ë§Œì¡±ë„ê°€ ë‚®ì„ ìˆ˜ ìˆìŒ</td></tr>
                                                <tr><td style="padding:.5rem; border-bottom:1px solid #e5e7eb;">88 ~ 116ì </td><td style="padding:.5rem; border-bottom:1px solid #e5e7eb;">í‰ê·  ì´í•˜ì˜ í–‰ë³µ - ì¼ìƒì—ì„œ ìŠ¤íŠ¸ë ˆìŠ¤ë‚˜ ë¶ˆë§Œì´ ìˆì„ ìˆ˜ ìˆìŒ</td></tr>
                                                <tr><td style="padding:.5rem; border-bottom:1px solid #e5e7eb;">117 ~ 145ì </td><td style="padding:.5rem; border-bottom:1px solid #e5e7eb;">í‰ê· ì ì¸ í–‰ë³µ - ì¼ë°˜ì ì¸ ì‚¬ëŒë“¤ê³¼ ë¹„ìŠ·í•œ ìˆ˜ì¤€ì˜ ì‚¶ì˜ ë§Œì¡±ë„</td></tr>
                                                <tr><td style="padding:.5rem; border-bottom:1px solid #e5e7eb;">146 ~ 174ì </td><td style="padding:.5rem; border-bottom:1px solid #e5e7eb;">ë†’ì€ í–‰ë³µ - ê¸ì •ì ì¸ ê°ì •ì´ ìì£¼ ëŠê»´ì§€ê³  ì‚¶ì— ëŒ€í•œ ë§Œì¡±ê°ì´ ë†’ìŒ</td></tr>
                                                <tr><td style="padding:.5rem;">175ì  ì´ìƒ</td><td style="padding:.5rem;">ë§¤ìš° ë†’ì€ í–‰ë³µ - ê·¹ë„ì˜ ê¸ì • ì •ì„œ ë° ë§Œì¡±ê°ì„ ê²½í—˜í•˜ëŠ” ìƒíƒœ</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </details>
                                <details>
                                    <summary style="cursor:pointer;font-weight:700;color:#334155">ë¬¸í•­ë³„ ì ìˆ˜ ë³´ê¸°</summary>
                                    <div style="margin-top:.5rem;display:grid;grid-template-columns: repeat(auto-fill,minmax(240px,1fr));gap:.5rem;">
                                        ${items.map((t,i)=>{
                                            const raw = state.answers[i];
                                            const adj = scoreOf(i, raw);
                                            const rev = reverseItems.has(i+1) ? ' (ì—­ì±„ì )' : '';
                                            return `<div style=\"padding:.5rem;border:1px solid #e5e7eb;border-radius:.5rem;background:#fff\"><div style=\"font-weight:700;color:#2563eb\">${i+1}. ${adj}ì ${rev}</div><div style=\"font-size:12px;color:#475569\">ì„ íƒ: ${raw ?? '-'}ì </div></div>`;
                                        }).join('')}
                                    </div>
                                </details>
                            </div>
                            <div class="nav">
                                <button class="btn secondary" onclick="state.screen='list'; render()">â† ì´ì „</button>
                                <div style="flex:1"></div>
                                <button class="btn" onclick="state.screen='completion'; render()">ë‹¤ìŒ â†’</button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            if (state.screen === 'completion') {
                app.innerHTML = `
                    <div class="container">
                        <div class="card">
                            <div style="text-align: center; padding: 2rem 0;">
                                <div style="font-size: clamp(48px, 10vw, 72px); margin-bottom: 1rem;">ğŸ‰</div>
                                <div class="title" style="font-size: clamp(28px, 6vw, 42px); font-weight: 900; color: #1e40af; margin-bottom: 1rem;">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!</div>
                                <div style="font-size: clamp(16px, 3vw, 20px); color: #475569; margin-bottom: 1.5rem; line-height: 1.6;">
                                    ì˜¥ìŠ¤í¼ë“œ í–‰ë³µ ì²™ë„ ê²€ì‚¬ë¥¼ ì™„ë£Œí•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.<br>
                                    ê²€ì‚¬ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë” í–‰ë³µí•œ ì¼ìƒì„ ë§Œë“¤ì–´ê°€ì‹œê¸¸ ë°”ëë‹ˆë‹¤.
                                </div>
                                <div style="font-size: clamp(13px, 2.2vw, 15px); color: #64748b; line-height: 1.6; margin-top: 2rem;">
                                    ì–¸ì œë“ ì§€ ë‹¤ì‹œ ê²€ì‚¬í•´ë³´ì‹œê³ ,<br>
                                    ê¾¸ì¤€í•œ ìê¸° ê´€ë¦¬ë¡œ í–‰ë³µì„ ìœ ì§€í•˜ì„¸ìš”! ğŸ’ª
                                </div>
                            </div>
                            <div class="nav">
                                <button class="btn secondary" onclick="state.screen='result'; render()">â† ì´ì „</button>
                                <div style="flex:1"></div>
                                <button class="btn" onclick="restart()">ì²˜ìŒìœ¼ë¡œ</button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
        }

        function selectChoice(i, val) {
            if (state.answers[i] === val) {
                delete state.answers[i];
            } else {
                state.answers[i] = val;
            }
            render();
        }
        function nextQ() {
            if (state.index < items.length - 1) {
                state.index++;
                render();
            } else {
                state.screen = 'list';
                render();
            }
        }
        function prevQ() { if (state.index > 0) { state.index--; render(); } }
        function openList() { state.screen = 'list'; render(); }
        function gotoQ(i) { state.index = i; state.screen = 'test'; render(); }
        function finish() { state.screen = 'result'; render(); }
        function restart() { state = { screen: 'intro', index: 0, answers: {}, userName: '', userGender: '', userAge: '', consent: false }; render(); }

        function startTestFromInfo() {
            const nameEl = document.getElementById('u-name');
            const ageEl = document.getElementById('u-age');
            const consentEl = document.getElementById('u-consent');
            const genderEl = document.querySelector('input[name="u-gender"]:checked');
            state.userName = nameEl ? nameEl.value.trim() : '';
            state.userAge = ageEl ? ageEl.value : '';
            state.consent = consentEl ? consentEl.checked : false;
            state.userGender = genderEl ? genderEl.value : '';
            if (!state.userName) { alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            if (!state.userGender) { alert('ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            if (!state.userAge) { alert('ë‚˜ì´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            if (!state.consent) { alert('ì •ë³´ í™œìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”.'); return; }
            state.screen = 'test';
            render();
        }

        window.addEventListener('DOMContentLoaded', render);
    </script>
</head>
<body>
    <div id="app"></div>
</body>
</html>

